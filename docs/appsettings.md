>[На главную](../README.md)
#

# Конфигурационные настройки приложения

## 1. Logging (базовая система логирования)

Отвечает за уровни логирования по умолчанию и для системных компонентов.

### Параметры

- **`LogLevel.Default`**
  - *Тип:* строка
  - *Значение по умолчанию:* `"Information"`
  - *Описание:* базовый уровень логирования для всех компонентов приложения.

- **`LogLevel.Microsoft.AspNetCore`**
  - *Тип:* строка
  - *Значение:* `"Warning"`
  - *Описание:* переопределяет уровень логирования для компонентов ASP.NET Core (только предупреждения и ошибки).

- **`LogLevel.Microsoft.AspNetCore.Diagnostics.HealthChecks.HealthCheckService`**
  - *Тип:* строка
  - *Значение:* `"Information"`
  - *Описание:* уровень логирования для сервиса health checks ASP.NET Core.

- **`LogLevel.Microsoft.Extensions.Diagnostics.HealthChecks`**
  - *Тип:* строка
  - *Значение:* `"Information"`
  - *Описание:* уровень логирования для системы health checks в Microsoft.Extensions.

---

## 2. Serilog (расширенная система логирования)

Настраивает продвинутое логирование с несколькими приёмниками (sink).

### 2.1. MinimumLevel

Определяет минимальные уровни логирования.

- **`Default`**
  - *Тип:* строка
  - *Значение:* `"Information"`
  - *Описание:* общий минимальный уровень для всех источников.

- **`Override`**
  - *Тип:* объект
  - *Описание:* переопределение уровней для конкретных пространств имён:
    - `"Microsoft"` → `"Warning"` — снижает уровень логирования для Microsoft‑компонентов до Warning;
    - `"System"` → `"Warning"` — снижает уровень логирования для системных компонентов до Warning.

### 2.2. WriteTo

Список приёмников (sink) для записи логов.

- **Console**
  - *Описание:* вывод логов в консоль. Используется для локального тестирования и отладки.

- **Elasticsearch** (приёмник № 1 — для health check логов)
  - *Описание:* отправка логов в Elasticsearch с условием маршрутизации для health check‑событий.
  - *Параметры:*
    - `nodeUris` — URI узлов Elasticsearch (`"http://localhost:9200"`).
    - `indexFormat` — формат имени индекса с датой (`"logs-cottage-sensor-aggregator-dev-healthcheck-{0:yyyy.MM.dd}"`).
    - `autoRegisterTemplate` — автоматическая регистрация шаблона индекса (`true`).
    - `batchPostingLimit` — количество логов в одном пакете отправки (`50`).
    - `bufferBaseFilename` — базовый путь для буферных файлов (`"logs/buffer-cottage-sensor-aggregator-dev-healthcheck"`).
    - `bufferFileSizeLimitBytes` — максимальный размер буферного файла (`5 242 880` байт = 5 МБ).
    - `flushInterval` — интервал отправки буфера (`"00:00:10"` — каждые 10 секунд).
    - `condition` — условие маршрутизации: логи с `LogType='HealthCheck'` попадают в этот индекс.

- **Elasticsearch** (приёмник № 2 — для общих логов приложения)
  - *Описание:* отправка логов в Elasticsearch с условием маршрутизации для общих событий приложения.
  - *Параметры:*
    - `nodeUris` — URI узлов Elasticsearch (`"http://localhost:9200"`).
    - `indexFormat` — формат имени индекса с датой (`"logs-cottage-sensor-aggregator-dev-app-{0:yyyy.MM.dd}"`).
    - `autoRegisterTemplate` — автоматическая регистрация шаблона индекса (`true`).
    - `batchPostingLimit` — количество логов в одном пакете отправки (`50`).
    - `bufferBaseFilename` — базовый путь для буферных файлов (`"logs/buffer-cottage-sensor-aggregator-dev-app"`).
    - `bufferFileSizeLimitBytes` — максимальный размер буферного файла (`5 242 880` байт = 5 МБ).
    - `flushInterval` — интервал отправки буфера (`"00:00:10"` — каждые 10 секунд).
    - `condition` — условие маршрутизации: логи с `LogType='Application'` попадают в этот индекс.

### 2.3. Enrich

Список обогатителей (enrichers) для добавления метаданных в логи:

- `FromLogContext` — добавляет данные из контекста логирования (свойства, установленные через `LogContext.PushProperty()` или `BeginScope()`).
- `WithMachineName` — добавляет имя машины, на которой выполняется приложение.
- `WithThreadId` — добавляет ID потока выполнения для отладки многопоточных сценариев.

---

## 3. AllowedHosts

- **`AllowedHosts`**
  - *Тип:* строка
  - *Значение:* `"*"`
  - *Описание:* разрешённые хосты для приёма запросов. Значение `"*"` разрешает все хосты. В продакшене рекомендуется указывать конкретные домены.

---

## 4. Kestrel (веб‑сервер)

Настройки встроенного сервера Kestrel.

- **`Endpoints.Http`**
  - *Описание:* конфигурация HTTP‑конечной точки.
  - *Параметры:*
    - `Url` — адрес и порт для прослушивания (`"http://localhost:9500"`).

---

## 5. ZontSettings (настройки интеграции с Zont)

Настройки для интеграции с системой Zont.

- `Email`
  - *Тип:* строка
  - *Значение по умолчанию:* `""` (пусто)
  - *Описание:* электронная почта для авторизации в API Zont. Требует заполнения в рабочей среде.

- `Login`
  - *Тип:* строка
  - *Значение по умолчанию:* `""` (пусто)
  - *Описание:* логин для доступа к API Zont. Требует заполнения в рабочей среде.

- `Password`
  - *Тип:* строка
  - *Значение по умолчанию:* `""` (пусто)
  - *Описание:* пароль для доступа к API Zont. Должен храниться в защищённом хранилище (Azure Key Vault, AWS Secrets Manager и т. д.).

- `ApiUrl`
  - *Тип:* строка
  - *Значение:* `"https://my.zont.online/api/widget/v3/"`
  - *Описание:* URL API Zont для взаимодействия с системой.

---

## 6. HealthCheckSettings (настройки health checks)

Параметры для настройки механизма health checks приложения.

- `Interval`
  - *Тип:* строка (формат `hh:mm:ss`)
  - *Значение:* `"00:05:00"` (5 минут)
  - *Описание:* интервал между проверками здоровья приложения.

- `IsEnabled`
  - *Тип:* булево
  - *Значение:* `true`
  - *Описание:* флаг включения механизма health checks.

- `Delay`
  - *Тип:* строка (формат `hh:mm:ss`)
  - *Значение:* `"00:00:01"` (1 секунда)
  - *Описание:* задержка перед стартом health checks после запуска приложения.

- `Period`
  - *Тип:* строка (формат `hh:mm:ss`)
  - *Значение:* `"00:00:01"` (1 секунда)
  - *Описание:* период выполнения проверок здоровья.

---

## 7. Jwt (настройки JWT‑аутентификации)

Параметры для работы с JWT‑токенами.

- `Issuer`
  - *Тип:* строка
  - *Значение по умолчанию:* `""` (пусто)
  - *Описание:* издатель токенов. Требует заполнения в рабочей среде.

- `Audience`
  - *Тип:* строка
  - *Значение по умолчанию:* `""` (пусто)
  - *Описание:* аудитория токенов. Требует заполнения в рабочей среде.

- `Key`
  - *Тип:* строка
  - *Значение по умолчанию:* `""` (пусто)
  - *Описание:* секретный ключ для подписи токенов. Должен храниться в защищённом хранилище.

---

## Примечания

1. **Пустые значения** (например, `""`) требуют заполнения в рабочей среде для корректной работы приложения.
2. **Безопасность:** поля с паролями и ключами (например, `Jwt.Key`, `ZontSettings.Password`) должны храниться в защищённых хранилищах (Azure Key Vault, AWS Secrets Manager, Hashicorp Vault и т. д.).
3. **Elasticsearch:** параметр `nodeUris` необходимо заполнить реальными URI узлов кластера в рабочей среде. Для продакшена рекомендуется использовать несколько узлов для отказоустойчивости.
4. **Порт Kestrel:** `9500` может быть изменён в зависимости от требований

#
>[В начало](#документация-по-конфигурационным-настройкам-приложения)  
>[На главную](../README.md)
